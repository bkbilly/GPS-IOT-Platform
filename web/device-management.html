<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Management - GPS Fleet Tracker</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/device-management.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">
                <a href="gps-dashboard.html" class="back-btn">‚Üê</a>
                <div>
                    <h1>Device Management</h1>
                    <p style="color: var(--text-muted); margin-top: 0.5rem;">Configure and manage your GPS devices</p>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <a href="user-settings.html" class="btn btn-secondary">
                    ‚öôÔ∏è User Settings
                </a>
                <button class="btn btn-primary" onclick="openAddDeviceModal()">
                    ‚ûï Add New Device
                </button>
            </div>
        </div>
        
        <div id="alertContainer"></div>
        
        <div class="devices-grid" id="devicesGrid">
            <!-- Devices will be loaded here -->
        </div>
    </div>
    
    <!-- Add/Edit Device Modal -->
    <div class="modal" id="deviceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Device</h2>
                <button class="modal-close" onclick="closeDeviceModal()">‚úï</button>
            </div>
            
            <form id="deviceForm" onsubmit="handleSubmit(event)">
                <div class="form-main-layout">
                    <!-- Column 1: General Info -->
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Device Name *</label>
                            <input type="text" class="form-input" id="deviceName" required placeholder="e.g. Delivery Van 1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">IMEI *</label>
                            <input type="text" class="form-input" id="deviceImei" required placeholder="15-20 digits">
                        </div>
                        
                        <!-- REMOVED: Protocol and Vehicle Type Selects from UI -->
                        
                        <div class="config-section">
                            <h3 class="config-title">Vehicle Details</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Type</label>
                                    <select class="form-select" id="vehicleType">
                                        <option value="car">üöó Car</option>
                                        <option value="truck">üöõ Truck</option>
                                        <option value="van">üöê Van</option>
                                        <option value="motorcycle">üèçÔ∏è Motorcycle</option>
                                        <option value="bus">üöå Bus</option>
                                        <option value="person">üö∂ Personal Tracker</option>
                                        <option value="airplane">‚úàÔ∏è Airplane</option>
                                        <option value="bicycle">üö≤ Bicycle</option>
                                        <option value="boat">üö¢ Boat / Marine</option>
                                        <option value="scooter">üõ¥ Scooter</option>
                                        <option value="tractor">üöú Tractor</option>
                                        <option value="arrow">‚ñ≤ Arrow (Directional)</option>
                                        <option value="other">üì¶ Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Plate</label>
                                    <input type="text" class="form-input" id="licensePlate">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">VIN</label>
                                <input type="text" class="form-input" id="vin">
                            </div>
                        </div>
                        
                        <div class="config-section">
                            <h3 class="config-title">Maintenance</h3>
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem;">
                                <div class="form-group"><label class="form-label">Oil (km)</label><input type="number" class="form-input" id="oilChangeKm"></div>
                                <div class="form-group"><label class="form-label">Tire (km)</label><input type="number" class="form-input" id="tireRotationKm"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Column 2: Alerts -->
                    <div class="form-column">
                        <div class="config-section">
                            <h3 class="config-title">Alert & Channel Rules</h3>
                            <div id="activeAlertsList" class="alert-config-list">
                                <!-- Alert items will be added here -->
                            </div>
                            
                            <div class="alert-add-container">
                                <select class="form-input" id="addAlertSelect" style="flex:1;"></select>
                                <button type="button" class="btn btn-secondary" onclick="addSelectedAlert()">Add</button>
                            </div>
                            <div style="margin-top:1.5rem; padding-top:1rem; border-top:1px solid var(--border-color);">
                                <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 1rem;">
                                    <h4 style="font-size: 1rem; margin: 0;">Custom Rules</h4>
                                    <a href="https://github.com/caronc/apprise" target="_blank" style="font-size: 0.8rem; color: var(--accent-primary); text-decoration: none;">Apprise Documentation ‚Üó</a>
                                </div>
                                <div id="customRulesList" class="alert-config-list"></div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem;">
                                    <input type="text" id="newRuleName" class="form-input" placeholder="Rule Name">
                                    <div style="display: flex; gap: 0.5rem;">
                                        <input type="text" id="newRuleCond" class="form-input" placeholder="Condition e.g. speed > 120">
                                        <button type="button" class="btn btn-secondary" onclick="addCustomRule()">Add</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeDeviceModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <span id="submitText">Save Changes</span>
                        <span id="submitLoading" class="loading" style="display:none;"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Raw Data Modal -->
    <div class="modal" id="rawDataModal">
        <div class="modal-content wide">
            <div class="modal-header">
                <h2 class="modal-title">Raw History</h2>
                <button class="modal-close" onclick="closeRawDataModal()">‚úï</button>
            </div>
            <div style="overflow-x:auto;">
                <table class="raw-data-table">
                    <thead><tr><th>Time</th><th>Lat</th><th>Lon</th><th>Speed</th><th>Heading</th><th>Sat</th><th>Ign</th><th>Attributes</th></tr></thead>
                    <tbody id="rawDataBody"></tbody>
                </table>
            </div>
            <div class="pagination">
                <button class="btn btn-secondary" id="prevPageBtn" onclick="changeRawDataPage(-1)">Previous</button>
                <span class="page-info" id="pageInfo"></span>
                <button class="btn btn-secondary" id="nextPageBtn" onclick="changeRawDataPage(1)">Next</button>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/device-management.js"></script>
</body>
</html>