<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Settings - Routario</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <link rel="icon" href="/icons/favicon.ico">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Routario">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">

    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/user-settings.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="gps-dashboard.html" class="back-btn">‚Üê</a>
            <h1>User Settings</h1>
        </div>

        <form onsubmit="saveSettings(event)">
            <!-- Account Info -->
            <div class="card">
                <h2 class="card-title">Account Information</h2>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" id="username" class="form-input" disabled style="opacity: 0.6;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="email" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">New Password</label>
                    <input type="password" id="password" class="form-input" placeholder="Leave blank to keep current">
                </div>
                <div style="display: flex; justify-content: flex-end; margin-top: 0.5rem;">
                    <button type="submit" class="btn btn-primary" id="saveBtn">
                        Save Profile Changes
                    </button>
                </div>
            </div>

            <!-- Notifications -->
            <div class="card">
                <h2 class="card-title">
                    Notification Channels
                </h2>
                <p style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 1.5rem; line-height: 1.5;">
                    Configure services to receive alerts (e.g., Telegram, Discord, Email).<br>
                    <span style="display: inline-block; margin-top: 0.5rem;">
                        üìö <strong>How to format URLs:</strong> 
                        <a href="https://github.com/caronc/apprise/wiki" target="_blank" style="color: var(--accent-primary); text-decoration: none; border-bottom: 1px dotted currentColor;">
                            Read Apprise Documentation ‚Üó
                        </a>
                    </span>
                </p>
                
                <div style="overflow-x: auto;">
                    <table class="channel-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Apprise URL</th>
                                <th style="text-align: right;">Action</th>
                            </tr>
                        </thead>
                        <tbody id="channelListBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <div class="add-channel-form">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">Channel Name</label>
                        <input type="text" id="newChannelName" class="form-input" placeholder="e.g. My Phone">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">Apprise URL</label>
                        <input type="text" id="newChannelUrl" class="form-input" placeholder="tgram://bot_token/chat_id">
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addChannel()">Add</button>
                </div>
            </div>

            <!-- Admin Panel (Hidden by default) -->
            <div class="card" id="adminPanel" style="display: none;">
                <h2 class="card-title" style="color: var(--accent-warning);">Admin Panel</h2>
                
                <div class="form-group">
                    <h3 style="font-size: 1rem; margin-bottom: 1rem;">Manage Users</h3>
                    <div id="userList">
                        <!-- User list populated here -->
                    </div>
                </div>

                <div class="add-channel-form" style="border-color: var(--border-color);">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">New Username</label>
                        <input type="text" id="newUserName" class="form-input">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">New Email</label>
                        <input type="email" id="newUserEmail" class="form-input">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">Password</label>
                        <input type="password" id="newUserPass" class="form-input">
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addNewUser()">Add User</button>
                </div>
            </div>
        </form>
    </div>

    <!-- Device Assignment Modal -->
    <div class="modal" id="assignModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Manage Devices for <span id="assignUserName" style="color: var(--accent-primary);"></span></h2>
                <button style="background:transparent; border:none; color:var(--text-muted); cursor:pointer; font-size:1.5rem;" onclick="closeAssignModal()">‚úï</button>
            </div>
            <div class="form-group">
                <input type="text" class="form-input" id="deviceSearch" placeholder="Search devices..." onkeyup="filterDeviceList()">
            </div>
            <div class="device-assign-list" id="deviceAssignList">
                <!-- Populated dynamically -->
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/user-settings.js"></script>
    <script src="js/pwa.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => initPWA());
    </script>
</body>
</html>